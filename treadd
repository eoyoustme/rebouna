--===== TẠO ĐỒNG HỒ DREAD CLOCK =====--
local omg = Instance.new("Model")
omg.Name = "DreadClock"
omg.Parent = workspace.CurrentRooms[game.ReplicatedStorage.GameData.LatestRoom.Value]

local currentLoadedRoom = workspace.CurrentRooms[game.ReplicatedStorage.GameData.LatestRoom.Value]
local eyes = game:GetObjects("rbxassetid://137635380358627")[1]

local num = 0
if currentLoadedRoom:FindFirstChild("PathfindNodes") then
   num = math.floor(#currentLoadedRoom.PathfindNodes:GetChildren() / 2)
end

eyes:PivotTo((num == 0 and currentLoadedRoom[currentLoadedRoom.Name] or currentLoadedRoom.PathfindNodes[num]).CFrame + Vector3.new(0, 5, 0))
eyes.Parent = omg
eyes.PrimaryPart.Anchored = true

--===== TẢI VÀ PHÁT ÂM THANH CLOCK =====--
function GitAud(soundlink, filename)
    local FileName = filename .. ".mp3"
    if not isfile(FileName) then
        writefile(FileName, game:HttpGet(soundlink))
    end
    return (getcustomasset or getsynasset)(FileName)
end

function CustomGitSound(soundlink, vol, filename, duration)
    local DreadSound = Instance.new("Sound", workspace)
    DreadSound.SoundId = GitAud(soundlink, filename)
    DreadSound.Volume = vol
    DreadSound.Looped = true
    DreadSound:Play()
    task.delay(duration, function()
        DreadSound:Destroy()
    end)
end

CustomGitSound("https://github.com/Kotyara19k-Doorsspawner/Random-files/raw/main/ClockSounds.mp3", 1, "DreadClock", 10)

--===== TẠO THỰC THỂ DREAD =====--
local Spawner = loadstring(game:HttpGet("https://raw.githubusercontent.com/RegularVynixu/Utilities/main/Doors/Entity%20Spawner/V1/Source.lua"))()

local entity = Spawner.createEntity({
    CustomName = "Dread",
    Model = "rbxassetid://12329981842",
    Speed = 120,
    MoveDelay = 1,
    HeightOffset = 0,
    CanKill = true,
    KillRange = 10,
    SpawnInFront = false,
    ShatterLights = false,
    FlickerLights = {
        Enabled = false,
        Duration = 1
    },
    Cycles = {
        Min = 1,
        Max = 1,
        Delay = 0
    },
    CamShake = {
        Enabled = true,
        Values = {1.5, 20, 0.1, 1},
        Range = 100
    },
    ResistCrucifix = false,
    BreakCrucifix = true,
    DeathMessage = {"You died to Dread", "Wait...", "How You?..", "Ok..", "...", "Just Hide When The Clock Sound Stops.."},
    IsCuriousLight = false
})

--===== DEBUG CALLBACKS =====--
entity.Debug.OnEntitySpawned = function()
    print("Entity has spawned")
    game.ReplicatedStorage.GameData.StopTime.Value = true
end

entity.Debug.OnEntityDespawned = function()
    print("Entity has despawned")

    -- Xoá đồng hồ nếu có
    if workspace:FindFirstChild("Grandfather_Clock") then
        workspace.Grandfather_Clock:Destroy()
    end

    -- Jumpscare effect
    local player = game.Players.LocalPlayer
    local playerGui = player:WaitForChild("PlayerGui")
    local camera = workspace.CurrentCamera

    local screenGui = Instance.new("ScreenGui", playerGui)
    screenGui.Name = "DreadJumpscare"
    screenGui.IgnoreGuiInset = true

    local background = Instance.new("ImageLabel", screenGui)
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundColor3 = Color3.new(0, 0, 0)
    background.BackgroundTransparency = 0
    background.Image = "rbxassetid://1712510813"
    background.ImageTransparency = 0.5

    local face = Instance.new("ImageLabel", screenGui)
    face.Size = UDim2.new(0, 300, 0, 300)
    face.AnchorPoint = Vector2.new(0.5, 0.5)
    face.Position = UDim2.new(0.5, 0, 0.5, 0)
    face.Image = "rbxassetid://11395249132"
    face.BackgroundTransparency = 1

    local sound = Instance.new("Sound", workspace)
    sound.SoundId = "rbxassetid://18459521002"
    sound.Volume = 8
    sound.Looped = false
    sound:Play()

    -- Camera Zoom
    local originalFov = camera.FieldOfView
    camera.CameraType = Enum.CameraType.Scriptable
    game:GetService("TweenService"):Create(camera, TweenInfo.new(0.7), {FieldOfView = 60}):Play()
    game:GetService("TweenService"):Create(face, TweenInfo.new(0.7), {
        Size = UDim2.new(0, 1200, 0, 1200),
        Position = UDim2.new(0.5, 0, 0.5, 0)
    }):Play()

    -- Blink effect
    task.spawn(function()
        for i = 1, 6 do
            background.ImageTransparency = 0.1
            task.wait(0.07)
            background.ImageTransparency = 0.6
            task.wait(0.07)
        end
    end)

    -- Cleanup after 2s
    task.delay(2, function()
        camera.CameraType = Enum.CameraType.Custom
        camera.FieldOfView = originalFov
        if screenGui then screenGui:Destroy() end
    end)

    -- Achievement
    local achievementGiver = loadstring(game:HttpGet("https://raw.githubusercontent.com/RegularVynixu/Utilities/main/Doors/Custom%20Achievements/Source.lua"))()
    achievementGiver({
        Title = "Dead Of Night",
        Desc = "Tick tock goes the clock...",
        Reason = "Encounter Dread",
        Image = LoadCustomAsset("https://github.com/vct0721/Doors-Stuff/raw/main/Assets/36426864382.png")
    })

    wait(1)
    game.ReplicatedStorage.GameData.StopTime.Value = false
end

entity.Debug.OnEntityStartMoving = function()
    print("Entity started moving")
end

entity.Debug.OnEntityFinishedRebound = function()
    print("Entity finished rebound")
end

entity.Debug.OnEntityEnteredRoom = function(room)
    print("Entity entered room:", room)
end

entity.Debug.OnLookAtEntity = function()
    print("Player looking at entity")
end

entity.Debug.OnDeath = function()
    print("Player has died")
end

--===== RUN ENTITY =====--
Spawner.runEntity(entity)
