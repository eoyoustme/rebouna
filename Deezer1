-- == Cấu hình ==
local ENTITY_MODEL_IDS = {
    "rbxassetid://12174018892" -- Thay ID khác nếu cần
}
local SOUND_ASSET_ID = "rbxassetid://8028069841"

local INITIAL_WALKSPEED = 16
local SPAWN_DISTANCE_BEHIND_PLAYER = 3

-- == Biến toàn cục ==
local depthsTer, playerHumanoid, currentEntityModelID = nil, nil, nil

-- == Hàm phát âm thanh ==
local function PlaySpawnSound()
    local sound = Instance.new("Sound", workspace)
    sound.Name = "SpawnSound"
    sound.Volume = 6
    sound.SoundId = SOUND_ASSET_ID
    sound:Play()
    sound.Ended:Connect(function() sound:Destroy() end)
    print("[Debug] Sound played.")
end

-- == Hàm spawn thực thể ==
local function spawnEntity()
    print("[Debug] spawnEntity() called.")
    local player = game.Players.LocalPlayer
    if not player or not player.Character then print("[Debug] No player or character") return end

    local hrp = player.Character:FindFirstChild("HumanoidRootPart")
    playerHumanoid = player.Character:FindFirstChildOfClass("Humanoid")
    if not hrp or not playerHumanoid then print("[Debug] Missing HRP or Humanoid") return end

    local modelID = ENTITY_MODEL_IDS[math.random(1,#ENTITY_MODEL_IDS)]
    currentEntityModelID = modelID
    print("[Debug] Trying modelID:", modelID)

    local success, model = pcall(function()
        return game:GetObjects(modelID)[1]
    end)
    if not success then
        print("[Debug] game:GetObjects pcall error:", model)
        return
    elseif not model then
        print("[Debug] game:GetObjects returned nil model")
        return
    else
        print("[Debug] game:GetObjects success")
    end

    depthsTer = model
    depthsTer.Parent = workspace
    print("[Debug] Parent set to workspace")

    local primary = depthsTer:FindFirstChildWhichIsA("BasePart")
    if not primary then
        print("[Debug] No BasePart found in model")
        depthsTer:Destroy()
        return
    end

    primary.CFrame = hrp.CFrame + (-hrp.CFrame.LookVector * SPAWN_DISTANCE_BEHIND_PLAYER) + Vector3.new(0,5,0)
    print("[Debug] Model positioned behind player:", primary.CFrame)

    for _, part in pairs(depthsTer:GetDescendants()) do
        if part:IsA("BasePart") then
            part.Anchored = false
            part.CanCollide = false
        end
    end

    PlaySpawnSound()
    print("[Debug] spawnEntity() completed.")
end

-- == Gọi spawn ngay sau load script ==
spawnEntity()
